---
import Layout from '@/layouts/Layout.astro';
import { createAuth } from '@/lib/auth';

let user = Astro.locals.user || null;
const env = Astro.locals.runtime?.env;

if (!user && env) {
  const auth = createAuth(env);
  const session = await auth.api.getSession({
    headers: Astro.request.headers,
  });
  user = session?.user || null;
}
---

<Layout title="Template Astro Vue Cloudflare">
  <div class="flex flex-col items-center justify-center min-h-[50vh] space-y-8">
    <h1 class="text-4xl font-bold">Template Astro Vue Cloudflare</h1>
    <p class="text-xl text-gray-600 dark:text-gray-400">
      A starter template for Astro, Vue, and Cloudflare Workers with Authentication.
    </p>
    
    {
      !user ? (
        <a
          href="/login"
          class="px-6 py-3 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors"
        >
          Get Started
        </a>
      ) : (
        <a
          href="/dashboard"
          class="px-6 py-3 text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors"
        >
          Go to Dashboard
        </a>
      )
    }
  </div>
</Layout>
